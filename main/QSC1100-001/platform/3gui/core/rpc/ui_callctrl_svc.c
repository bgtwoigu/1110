/*=============================================================================
                       U I _ C A L L C T R L _ S V C . C

GENERAL DESCRIPTION
  This is an AUTO GENERATED file that dispatches RPC requests targetting the
  ui_callctrl api.

Copyright (c) 2007 by QUALCOMM, Incorporated. All Rights Reserved.
=============================================================================*/

/*=============================================================================

                              Edit History

                             AUTO GENERATED                                  */
#ifdef FEATURE_HTORPC_METACOMMENTS
/* Generated by following versions of Htorpc modules:
Id: //depot/asic/msm7500/tools/build/htorpc/htorpc.pl#11 
Id: //depot/asic/msm7500/tools/build/htorpc/Htorpc/Start/Start.pm#36 
Id: //depot/asic/msm7500/tools/build/htorpc/Htorpc/Htoxdr/Htoxdr.pm#35 
Id: //depot/asic/msm7500/tools/build/htorpc/Htorpc/XDR/00.01/XDR.pm#34 
Id: //depot/asic/msm7500/tools/build/htorpc/Htorpc/Output/00.03/Output.pm#18 
Id: //depot/asic/msm7500/tools/build/htorpc/Htorpc/Parser/Parser.pm#26 
Id: //depot/asic/msm7500/tools/build/htorpc/Htorpc/Metacomments/Metacomments.pm#34 
Id: //depot/asic/msm7500/tools/build/htorpc/Htorpc/SymbolTable/SymbolTable.pm#25  */
#endif
/* $Id: //depot/asic/msmshared/apps/Core/rpc/ui_callctrl_svc.c#1 $
=============================================================================*/

#include "customer.h"
#include "target.h"

#ifdef FEATURE_ONCRPC
#ifdef FEATURE_EXPORT_UI_CALLCTRL

/* Include files */
#include "err.h"
#include "msg.h"

#include "ui_callctrl.h"
#include "ui_callctrl_rpc.h"

/* Only one copy needed per API */
//static opaque_auth Ui_callctrlCred = { ONCRPC_AUTH_NONE, 0, 0 };
static opaque_auth Ui_callctrlVerf = { ONCRPC_AUTH_NONE, 0, 0 };


/*=======================================================================
             Prototypes for the API's RPC Server Functions
=======================================================================*/

static void ui_callctrlprog_0 ( struct svc_req *rqstp, xdr_s_type *srv );

static void ui_callctrl_null_0( xdr_s_type *svc );

static void ui_set_restrictions_0( xdr_s_type *srv );

/******************************************************************************/
/*=======================================================================
             API RPC Server Implementation
=======================================================================*/

void ui_callctrl_app_init( void )
{

  ui_callctrl_app_init_with_proxy( NULL );

} /* ui_callctrl_app_init */

void ui_callctrl_app_init_with_proxy( oncrpc_proxy_task_s_type *proxy )
{

  xdr_s_type *transp;

#if (defined FEATURE_ONCRPC_SM)
  transp = svcsm_create(0, 0);
  if ( transp == NULL ) {
    ERR_FATAL("cannot create sm service.", 0, 0, 0);
  }
  if ( !svc_register_with_proxy(transp, UI_CALLCTRLPROG, UI_CALLCTRLVERS,
                                ui_callctrlprog_0, (-3), proxy) ) {
    ERR_FATAL("unable to register (UI_CALLCTRLPROG, UI_CALLCTRLVERS, sm).",0,0,0);
  }

#endif /* (defined FEATURE_ONCRPC_SM) */

} /* ui_callctrl_app_init_with_proxy */

void ui_callctrl_app_lock( boolean lock )
{
  svc_lock( UI_CALLCTRLPROG, UI_CALLCTRLVERS, lock );
} /* ui_callctrl_app_lock */

static void ui_callctrlprog_0 ( struct svc_req *rqstp, xdr_s_type *srv )
{

  XDR_ERRCHK( srv, ON );

  switch ( rqstp->rq_proc ) {
    case ONCRPC_UI_CALLCTRL_NULL_PROC:
      ui_callctrl_null_0( srv );
      break;
    case ONCRPC_UI_SET_RESTRICTIONS_PROC:
      ui_set_restrictions_0( srv );
      break;

    default:
      // invalid RPC procedure number
      (void) XDR_MSG_DONE( srv );
      svcerr_noproc( srv );
      break;
  }

  oncrpcxdr_mem_free( srv );

  XDR_ERRCHK( srv, OFF );

} /* ui_callctrlprog_0 */

/******************************************************************************/

static void ui_callctrl_null_0( xdr_s_type *srv )
{

  if ( ! XDR_MSG_DONE( srv ) ) {
    // Left over data in RPC msg, send svcerr_decode reply
    svcerr_decode( srv );
    return;
  }

  (void) xdr_reply_msg_start( srv, &Ui_callctrlVerf );
  if ( ! XDR_MSG_SEND( srv, NULL ) ) {
    ERR_FATAL( "ui_callctrl_null_0: XDR_MSG_SEND failed", 0, 0, 0 );
  }

} /* ui_callctrl_null */

static void ui_set_restrictions_0( xdr_s_type *srv )
{

  byte restriction_bitmask;
    if ( ! XDR_RECV_UINT8( srv, &restriction_bitmask ) ) {
      // send svcerr_decode reply
      XDR_MSG_DONE( srv );
      svcerr_decode( srv );
      return;
    }

  if ( ! XDR_MSG_DONE( srv ) ) {
    // Left over data in RPC msg
    svcerr_decode( srv );
    return;
  }

  ui_set_restrictions(restriction_bitmask);


  (void) xdr_reply_msg_start( srv, &Ui_callctrlVerf );

  if ( ! XDR_MSG_SEND( srv, NULL ) ) {
    ERR_FATAL( "ui_set_restrictions_0: XDR_MSG_SEND failed", 0, 0, 0 );
  }


} /* ui_set_restrictions_0 */

#endif /* FEATURE_EXPORT_UI_CALLCTRL */
#endif /* FEATURE_ONCRPC */
